<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Plist → XML Converter</title>
<link rel="icon" href="https://github.githubassets.com/favicons/favicon.svg" type="image/svg+xml">
<style>
  body {
    font-family: 'Space Mono', monospace;
    background: #0a0a0a;
    color: #00ff99;
    padding: 30px;
    text-align: center;
  }
  h2 { color: #00ffaa; font-size: 1.5em; margin-bottom: 15px; }
  textarea {
    width: 95%;
    height: 250px;
    margin: 10px 0;
    background: #111;
    color: #00ff99;
    border: 1px solid #333;
    border-radius: 6px;
    padding: 10px;
    resize: vertical;
  }
  button {
    background: #00ff99;
    color: #000;
    border: none;
    padding: 10px 15px;
    margin: 5px;
    cursor: pointer;
    font-weight: bold;
    border-radius: 6px;
    transition: background 0.2s;
  }
  button:hover { background: #00cc77; }
  footer {
    margin-top: 15px;
    color: #777;
    font-size: 0.8em;
  }
</style>
</head>
<body>
<h2>Plist → XML Converter</h2>
<input type="file" id="plistFile" accept=".plist" style="margin-bottom: 10px;"><br>
<textarea id="plistInput" placeholder="Or paste your .plist content here..."></textarea><br>
<button onclick="convert()">Convert</button>
<button onclick="copyOutput()">Copy XML</button>
<textarea id="xmlOutput" placeholder="Converted XML will appear here..."></textarea>
<footer>Made for GitHub Pages — works entirely offline.</footer>

<script>
function convert() {
  const fileInput = document.getElementById('plistFile');
  const plistText = document.getElementById('plistInput').value.trim();
  
  if (fileInput.files.length > 0) {
    const file = fileInput.files[0];
    const reader = new FileReader();
    reader.onload = function(e) {
      processPlist(e.target.result);
    };
    reader.readAsText(file);
  } else if (plistText.length > 0) {
    processPlist(plistText);
  } else {
    alert("Upload or paste a .plist file first!");
  }
}

function processPlist(plist) {
  const lines = plist.split('\n');
  
  // Try to detect texture name from plist
  let imageName = "spritesheet.png";
  for (let i = 0; i < lines.length; i++) {
    if (lines[i].includes("<key>textureFileName</key>")) {
      const match = lines[i + 1]?.match(/<string>(.*?)<\/string>/);
      if (match) imageName = match[1];
      break;
    }
  }

  let output = `<?xml version="1.0" encoding="utf-8"?> \n<TextureAtlas imagePath="${imageName}">\n`;

  for (let i = 0; i < lines.length; i++) {
    if (lines[i].includes("<key>") && lines[i].includes(".png</key>")) {
      const nameMatch = lines[i].match(/<key>(.*?)<\/key>/);
      if (!nameMatch) continue;
      const cleanName = nameMatch[1].replace(".png", "");

      const x = getValue(lines, i, "x");
      const y = getValue(lines, i, "y");
      const width = getValue(lines, i, "width");
      const height = getValue(lines, i, "height");
      const frameX = 0, frameY = 0, frameWidth = 234, frameHeight = 234;

      output += `\t<SubTexture name="${cleanName}" x="${x}" y="${y}" width="${width}" height="${height}" frameX="${frameX}" frameY="${frameY}" frameWidth="${frameWidth}" frameHeight="${frameHeight}"/>\n`;
    }
  }

  output += "</TextureAtlas>";
  document.getElementById('xmlOutput').value = output;
}

function getValue(lines, index, key) {
  for (let i = index; i < lines.length; i++) {
    if (lines[i].includes(`<key>${key}</key>`)) {
      const match = lines[i + 1]?.match(/<integer>(.*?)<\/integer>/);
      return match ? match[1] : 0;
    }
  }
  return 0;
}

function copyOutput() {
  const text = document.getElementById('xmlOutput');
  text.select();
  document.execCommand('copy');
  alert('XML copied to clipboard!');
}
</script>
</body>
</html>
