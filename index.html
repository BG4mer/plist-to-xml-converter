<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Plist → XML Converter</title>
<link rel="shortcut icon" type="image/png" href="./icon.png">
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
  * { margin:0; padding:0; box-sizing:border-box; font-family:"Space Mono", monospace; }
  body { background:#0e0e0e; color:#eee; display:flex; flex-direction:column; align-items:center; min-height:100vh; padding:20px; }
  h1 { font-size:24px; margin-bottom:20px; color:#00ffff; }
  textarea { width:90%; max-width:700px; height:200px; background:#1a1a1a; color:#00ffcc; border:1px solid #333; border-radius:6px; padding:10px; margin:10px 0; }
  button { padding:10px 25px; background:#00ffff; color:#000; font-weight:bold; border:none; border-radius:6px; cursor:pointer; margin:5px; transition:0.2s; }
  button:hover { background:#00cccc; }
  pre { background:#1a1a1a; color:#0f0; width:90%; max-width:700px; padding:10px; border-radius:6px; white-space:pre-wrap; word-wrap:break-word; }
</style>
</head>
<body>
  <h1>Plist → XML Converter</h1>
  <textarea id="plistInput" placeholder="Paste your .plist content here..."></textarea>
  <div>
    <button id="convertBtn">Convert</button>
    <button id="copyBtn">Copy Output</button>
  </div>
  <pre id="xmlOutput" placeholder="Converted XML will appear here..."></pre>

<script>
document.getElementById("convertBtn").addEventListener("click", () => {
  const input = document.getElementById("plistInput").value.trim();
  if (!input) return alert("Please paste a .plist file first!");

  try {
    const parser = new DOMParser();
    const xmlDoc = parser.parseFromString(input, "text/xml");

    const keys = xmlDoc.getElementsByTagName("key");
    const plistName = (input.match(/<string>([^<]*?)\.png<\/string>/) || [])[1] || "spritesheet";
    const imagePath = `${plistName}.png`;

    let output = `<?xml version="1.0" encoding="utf-8"?> \n<TextureAtlas imagePath="${imagePath}">\n`;

    for (let i = 0; i < keys.length; i++) {
      const key = keys[i];
      const name = key.textContent;
      const next = key.nextElementSibling;
      if (next && next.tagName === "dict") {
        const getVal = (k) => {
          const el = [...next.getElementsByTagName("key")].find(e => e.textContent === k);
          if (el && el.nextElementSibling) return el.nextElementSibling.textContent;
          return "";
        };

        const texRect = getVal("textureRect").replace(/[{}]/g, "").split(",");
        const srcSize = getVal("spriteSourceSize").replace(/[{}]/g, "").split(",");
        if (texRect.length < 4 || srcSize.length < 2) continue;

        const [x, y, w, h] = texRect.map(v => parseInt(v));
        const [fw, fh] = srcSize.map(v => parseInt(v));

        const cleanName = name.replace(".png", "");
        output += `\t<SubTexture name="${cleanName}" x="${x}" y="${y}" width="${w}" height="${h}" frameX="0" frameY="0" frameWidth="${fw}" frameHeight="${fh}"/>\n`;
      }
    }

    output += `</TextureAtlas>`;
    document.getElementById("xmlOutput").textContent = output;
  } catch (err) {
    alert("Error converting plist. Make sure it's valid XML.");
  }
});

document.getElementById("copyBtn").addEventListener("click", () => {
  const text = document.getElementById("xmlOutput").textContent;
  if (!text.trim()) return alert("Nothing to copy!");
  navigator.clipboard.writeText(text);
  alert("XML copied to clipboard!");
});
</script>
</body>
</html>
