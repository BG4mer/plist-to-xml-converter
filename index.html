<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Plist → XML Converter</title>
<link rel="icon" href="https://raw.githubusercontent.com/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');

body {
    margin: 0;
    font-family: 'Orbitron', sans-serif;
    background: linear-gradient(135deg, #0a0a1f, #1a1a33);
    color: #00ffea;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    min-height: 100vh;
    padding: 20px;
    overflow-x: hidden;
}

h1 {
    font-weight: 700;
    font-size: 2.2em;
    margin-bottom: 25px;
    color: #00ffea;
    text-shadow: 0 0 20px #00ffe1, 0 0 40px #00ffe1;
}

textarea, pre code {
    width: 90%;
    max-width: 950px;
    background: #111122;
    border: 2px solid #00ffea;
    border-radius: 14px;
    color: #00ffea;
    padding: 15px;
    font-family: 'Courier New', monospace;
    font-size: 14px;
    resize: none;
    margin-bottom: 20px;
    box-shadow: 0 0 15px #00ffea;
}

textarea:focus {
    outline: none;
    box-shadow: 0 0 25px #00ffea;
}

button {
    background: linear-gradient(45deg, #00ffea, #004466);
    border: none;
    padding: 12px 28px;
    margin: 5px;
    border-radius: 12px;
    font-weight: bold;
    color: #111122;
    cursor: pointer;
    font-family: 'Orbitron', sans-serif;
    text-transform: uppercase;
    transition: all 0.25s ease;
    box-shadow: 0 0 15px #00ffea, 0 0 25px #00ffea inset;
}

button:hover {
    transform: scale(1.08);
    box-shadow: 0 0 30px #00ffea, 0 0 40px #00ffea inset;
}

#outputContainer {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
}

pre {
    width: 90%;
    max-width: 950px;
    height: 350px;
    overflow-y: auto;
    background: #111122;
    border: 2px solid #00ffea;
    border-radius: 14px;
    padding: 15px;
    font-size: 14px;
    box-shadow: 0 0 15px #00ffea;
}

code {
    display: block;
    white-space: pre-wrap;
}
</style>
</head>
<body>

<h1>Plist → XML Converter</h1>

<textarea id="inputPlist" placeholder="Paste your .plist content here..."></textarea>

<div>
    <button onclick="convertPlist()">Convert</button>
    <button onclick="copyOutput()">Copy XML</button>
    <button onclick="downloadXML()">Download XML</button>
</div>

<div id="outputContainer">
    <pre><code id="outputXML" class="xml"></code></pre>
</div>

<script>
function convertPlist() {
    const plistText = document.getElementById('inputPlist').value;
    if (!plistText) {
        alert('Paste your plist first!');
        return;
    }

    // Extract image name
    const imageMatch = plistText.match(/<key>realTextureFileName<\/key>\s*<string>(.*?)<\/string>/);
    const imageName = imageMatch ? imageMatch[1] : 'PlayerExplosion.png';

    // Extract frames
    const frameRegex = /<key>(.*?)<\/key>\s*<dict>([\s\S]*?)<\/dict>/g;
    let match;
    let xmlOutput = `<?xml version="1.0" encoding="utf-8"?>\n<TextureAtlas imagePath="${imageName}">\n`;

    while ((match = frameRegex.exec(plistText)) !== null) {
        const frameName = match[1].replace('.png','');
        const dictContent = match[2];

        const rectMatch = dictContent.match(/<key>textureRect<\/key>\s*<string>{{(\d+),(\d+)}{,}?(\d+),(\d+)}}/) 
                         || dictContent.match(/<key>textureRect<\/key>\s*<string>{{(\d+),(\d+)},{(\d+),(\d+)}}/);

        const sourceMatch = dictContent.match(/<key>spriteSourceSize<\/key>\s*<string>{(\d+),(\d+)}/);

        if (rectMatch && sourceMatch) {
            const x = rectMatch[1];
            const y = rectMatch[2];
            const width = rectMatch[3];
            const height = rectMatch[4];
            const frameWidth = sourceMatch[1];
            const frameHeight = sourceMatch[2];
            const frameX = 0;
            const frameY = 0;

            xmlOutput += `\t<SubTexture name="${frameName}" x="${x}" y="${y}" width="${width}" height="${height}" frameX="${frameX}" frameY="${frameY}" frameWidth="${frameWidth}" frameHeight="${frameHeight}"/>\n`;
        }
    }

    xmlOutput += '</TextureAtlas>';

    const output = document.getElementById('outputXML');
    output.textContent = xmlOutput;
    hljs.highlightElement(output);
}

function copyOutput() {
    const output = document.getElementById('outputXML');
    navigator.clipboard.writeText(output.textContent);
    alert('Copied XML to clipboard!');
}

function downloadXML() {
    const output = document.getElementById('outputXML').textContent;
    const blob = new Blob([output], {type: "text/xml"});
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "converted.xml";
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
</script>

</body>
</html>
